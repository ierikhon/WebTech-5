extends layout

block content
    div(align='center')
        div(class='w3-container w3-green w3-margin-bottom')
            h3
                if (book["name"] && book["author"])
                    div Name:
                    b=" " + book["name"] + " "
                    div Author
                    b=" " + book["author"]
                else
                    span Add book
        if (book["stock"]==="No")
            button(class='w3-btn w3-ripple w3-green', onclick="document.getElementById('reader_dialog_r').style.display = 'block'") Show Reader Info
        else
            button(class='w3-btn w3-ripple w3-green w3-disabled') Show Reader Info
        form(class='w3-border w3-margin' style="width:50%")
            div(class='w3-container w3-green w3-margin-bottom') Edit book info
            div(class='w3-container')
                b Author
                input(id ='author_input', class='w3-input', type='text', value=book["author"])
                b Name
                input(id = 'name_input', class='w3-input', type='text', value=book["name"])
                b Date of Release
                input(id = 'date_input', class='w3-input', type='date', value=book["datarel"])
                b In stock
                input(id = 'stock_input', class='w3-input', type='text', value=book["stock"], disabled='true')
                b Id
                input(id = 'id_input', class='w3-input', type='text', value=id, disabled='true')


        div(class='w3-modal w3-container', id="reader_dialog_")
            div(class='w3-modal-content')
                span(onclick='document.getElementById("reader_dialog_").style.display="none"', class='w3-button w3-display-topright') &times
                div(class='w3-panel')
                    form
                        div(class='w3-container w3-margin-bottom')
                            h4 Add reader
                        div(class='w3-container')
                            b Name
                            input(id='reader_name', class='w3-input', type='name')
                            b Date of return
                            input(id='return_date', class='w3-input', type='date')
                            button(class='w3-btn w3-ripple w3-green w3-margin' onclick='saveBook("give")') Give book to the Reader

        div(class='w3-modal w3-container', id="reader_dialog_r")
            div(class='w3-modal-content')
                span(onclick='document.getElementById("reader_dialog_r").style.display="none"', class='w3-button w3-display-topright') &times
                    p taken by:
                    input(id = 'taken_input', class='w3-input', type='text', value=book["taken"]["pers"], disabled='true')
                    p at:
                    input(id = 'takenDate_input', class='w3-input', type='text', value=book["taken"]["date"], disabled='true')
                    p Return until
                    input(id = 'returnDate_input', class='w3-input', type='text', value=book["datareturn"], disabled='true')


    if (book["name"] && book["author"])
        div(class='w3-display-container' style='width:100%; height:50px')
            div(class='w3-display-left w3-margin')
                if (book["stock"] === "No")
                    button(class='w3-btn w3-ripple w3-green w3-disabled') Give Book
                    button(class='w3-btn w3-ripple w3-green' onclick="returnBook("+id+")") Return Book
                else
                    button(class='w3-btn w3-ripple w3-green', onclick="document.getElementById('reader_dialog_').style.display = 'block'") Give Book
                    button(class='w3-btn w3-ripple w3-green w3-disabled') Return Book

            div(class='w3-display-middle')
                button(class='w3-btn w3-ripple w3-green' onclick='saveBook("new")') Save Info
                button(class='w3-btn w3-ripple w3-red' onclick='deleteBook('+id+')') Delete Book
    else
        div(class='w3-display-container' style='width:100%; height:50px')
            div(class='w3-display-middle')
                button(class='w3-btn w3-ripple w3-green' onclick='saveBook("new")') Save Info

    script(src='../javascripts/scripts.js')
    script.
        function saveBook(type)
        {
            let newBookInfo = {};
            newBookInfo["name"] = document.getElementById("name_input").value;
            newBookInfo["author"] = document.getElementById("author_input").value;
            newBookInfo["datarel"] = document.getElementById("date_input").value;

            newBookInfo["id"] = document.getElementById("id_input").value;
            newBookInfo["taken"] = {};

            if (type === "new")
            {
                newBookInfo["taken"]["pers"] = document.getElementById("taken_input").value;
                newBookInfo["taken"]["date"] = document.getElementById("takenDate_input").value;
                newBookInfo["datareturn"] = document.getElementById("returnDate_input").value;
                newBookInfo["stock"] = document.getElementById("stock_input").value;
            }

            if (type === "give")
            {
                newBookInfo["taken"]["pers"] = document.getElementById("reader_name").value;
                newBookInfo["datareturn"] = document.getElementById("return_date").value;
                newBookInfo["stock"] = "No";

                let today = new Date();
                let month = today.getMonth()+1;
                let day = today.getDate();
                if (day < 10) {
                    day = '0' + day
                }

                if (month < 10) {
                    month = '0' + month
                }

                newBookInfo["taken"]["date"] = today.getFullYear() + "-" + month + "-" + day;
            }

            externalSave(newBookInfo);
        }



